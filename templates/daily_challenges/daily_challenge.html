{% extends 'base.html' %}
{% load static %}

{% block title %}Daily Challenge - CompileMate{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-orange-50 via-yellow-50 to-red-100 dark:from-gray-900 dark:via-orange-950 dark:to-red-950">
    <!-- Animated Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-10 w-72 h-72 bg-yellow-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
        <div class="absolute top-40 right-10 w-72 h-72 bg-orange-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-8 left-1/2 w-72 h-72 bg-red-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-4000"></div>
    </div>

    <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-600 via-yellow-600 to-red-600 mb-4">
                ğŸ¯ Today's Daily Challenge
            </h1>
            <p class="text-xl text-gray-600 dark:text-gray-300">
                Solve today's problem to maintain your streak and earn bonus rewards! ğŸ”¥
            </p>
            <div class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                {{ challenge.date|date:"l, F j, Y" }}
            </div>
        </div>

        <!-- Streak Stats Card -->
        <div class="bg-gradient-to-r from-orange-500 to-red-600 rounded-2xl shadow-2xl p-8 mb-8 text-white">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-center">
                <div>
                    <div class="text-6xl font-black mb-2">ğŸ”¥</div>
                    <div class="text-5xl font-black">{{ streak_stats.current_streak }}</div>
                    <div class="text-sm font-semibold opacity-90">Day Streak</div>
                </div>
                <div>
                    <div class="text-6xl font-black mb-2">ğŸ†</div>
                    <div class="text-5xl font-black">{{ streak_stats.longest_streak }}</div>
                    <div class="text-sm font-semibold opacity-90">Best Streak</div>
                </div>
                <div>
                    <div class="text-6xl font-black mb-2">âœ…</div>
                    <div class="text-5xl font-black">{{ streak_stats.total_challenges_completed }}</div>
                    <div class="text-sm font-semibold opacity-90">Completed</div>
                </div>
                <div>
                    <div class="text-6xl font-black mb-2">â„ï¸</div>
                    <div class="text-5xl font-black">{{ streak_stats.streak_freeze_count }}</div>
                    <div class="text-sm font-semibold opacity-90">Freezes</div>
                </div>
            </div>
        </div>

        <!-- Streak At Risk Warning -->
        {% if streak_at_risk %}
        <div class="bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/30 dark:to-orange-900/30 border-4 border-red-500 rounded-2xl p-6 mb-8 animate-pulse">
            <div class="flex items-center gap-6">
                <div class="text-6xl">âš ï¸</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-red-600 dark:text-red-400 mb-2">Streak at Risk!</h3>
                    <p class="text-gray-700 dark:text-gray-300">Your {{ streak_stats.current_streak }} day streak is about to break!</p>
                </div>
                {% if can_use_freeze %}
                <form method="POST" action="{% url 'daily_challenges:use_streak_freeze' %}">
                    {% csrf_token %}
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg">
                        Use Freeze â„ï¸
                    </button>
                </form>
                {% else %}
                <a href="{% url 'daily_challenges:streak_freeze_shop' %}" class="bg-purple-500 hover:bg-purple-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg inline-block">
                    Buy Freeze ğŸ›’
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Challenge Card -->
            <div class="lg:col-span-2">
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl rounded-2xl shadow-2xl border border-gray-200/50 dark:border-gray-700/50 overflow-hidden">
                    <div class="bg-gradient-to-r from-orange-500 to-red-600 p-6">
                        <div class="flex items-center justify-between text-white">
                            <div>
                                <div class="text-sm font-semibold opacity-90 mb-1">Today's Challenge</div>
                                <h2 class="text-3xl font-black">{{ challenge.problem.title }}</h2>
                            </div>
                            <div class="text-center">
                                <div class="text-4xl font-black">+{{ challenge.bonus_coins }}</div>
                                <div class="text-xs font-semibold opacity-90">Bonus Coins</div>
                            </div>
                        </div>
                    </div>

                    <div class="p-8">
                        <div class="flex items-center gap-4 mb-6">
                            <span class="px-4 py-2 bg-{{ challenge.problem.difficulty }}-100 text-{{ challenge.problem.difficulty }}-800 rounded-full text-sm font-bold">
                                {{ challenge.problem.get_difficulty_display }}
                            </span>
                            <span class="text-gray-600 dark:text-gray-400">
                                {{ challenge.participants_count }} participants
                            </span>
                            <span class="text-gray-600 dark:text-gray-400">
                                {{ challenge.completion_rate|floatformat:1 }}% completion rate
                            </span>
                        </div>

                        {% if participation %}
                            {% if participation.status == 'completed' %}
                                <div class="bg-green-50 dark:bg-green-900/20 border-2 border-green-500 rounded-xl p-6 text-center mb-6">
                                    <div class="text-6xl mb-4">ğŸ‰</div>
                                    <h3 class="text-2xl font-bold text-green-600 dark:text-green-400 mb-2">Challenge Completed!</h3>
                                    <p class="text-gray-700 dark:text-gray-300">You earned {{ participation.coins_earned }} coins and {{ participation.xp_earned }} XP!</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Time: {{ participation.time_taken }}</p>
                                </div>
                            {% else %}
                                <div class="bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-500 rounded-xl p-4 text-center mb-6">
                                    <p class="text-blue-600 dark:text-blue-400 font-semibold">Challenge in progress...</p>
                                </div>
                            {% endif %}
                        {% endif %}

                        <div class="flex gap-4">
                            {% if not participation %}
                                <form method="POST" action="{% url 'daily_challenges:start_challenge' %}" class="flex-1">
                                    {% csrf_token %}
                                    <button type="submit" class="w-full bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg transform hover:scale-105 transition-all">
                                        Start Challenge ğŸš€
                                    </button>
                                </form>
                            {% else %}
                                <a href="{% url 'problems:problem_solve' challenge.problem.slug %}" class="flex-1 text-center bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg transform hover:scale-105 transition-all inline-block">
                                    {% if participation.status == 'completed' %}
                                        View Solution ğŸ‘€
                                    {% else %}
                                        Continue Challenge â–¶ï¸
                                    {% endif %}
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard & Actions -->
            <div class="space-y-6">
                <!-- Quick Actions -->
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-gray-200/50 dark:border-gray-700/50">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <a href="{% url 'daily_challenges:streak_freeze_shop' %}" class="block bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-6 py-3 rounded-xl font-semibold text-center transform hover:scale-105 transition-all">
                            ğŸ›’ Streak Freeze Shop
                        </a>
                        <a href="{% url 'daily_challenges:challenge_history' %}" class="block bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white px-6 py-3 rounded-xl font-semibold text-center transform hover:scale-105 transition-all">
                            ğŸ“Š Challenge History
                        </a>
                        <a href="{% url 'daily_challenges:streak_leaderboard' %}" class="block bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white px-6 py-3 rounded-xl font-semibold text-center transform hover:scale-105 transition-all">
                            ğŸ† Streak Leaderboard
                        </a>
                    </div>
                </div>

                <!-- Today's Leaderboard -->
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-gray-200/50 dark:border-gray-700/50">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                        âš¡ Fastest Solvers Today
                    </h3>
                    {% if leaderboard %}
                        <div class="space-y-3">
                            {% for entry in leaderboard %}
                            <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-lg">
                                <div class="text-2xl font-black {% if entry.rank == 1 %}text-yellow-500{% elif entry.rank == 2 %}text-gray-400{% elif entry.rank == 3 %}text-orange-600{% else %}text-gray-600{% endif %}">
                                    #{{ entry.rank }}
                                </div>
                                <div class="flex-1">
                                    <div class="font-bold text-gray-900 dark:text-white">{{ entry.user.username }}</div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">{{ entry.time_taken }}</div>
                                </div>
                                {% if entry.rank == 1 %}ğŸ‘‘{% elif entry.rank == 2 %}ğŸ¥ˆ{% elif entry.rank == 3 %}ğŸ¥‰{% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <div class="text-4xl mb-2">ğŸƒ</div>
                            <div class="text-sm">Be the first to complete!</div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
@keyframes blob {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(30px, -50px) scale(1.1); }
    66% { transform: translate(-20px, 20px) scale(0.9); }
}
.animate-blob { animation: blob 7s infinite; }
.animation-delay-2000 { animation-delay: 2s; }
.animation-delay-4000 { animation-delay: 4s; }
</style>
{% endblock %}

