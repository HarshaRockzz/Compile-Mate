{% extends 'base.html' %}
{% load static %}

{% block title %}Marketplace - CompileMate{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 dark:from-gray-900 dark:via-purple-950 dark:to-indigo-950">
    <!-- Header -->
    <div class="relative z-10 bg-white/60 dark:bg-gray-800/60 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-700/50 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="text-center md:text-left">
                    <h1 class="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-400 dark:to-pink-400">
                        Rewards Marketplace
                    </h1>
                    <p class="text-gray-600 dark:text-gray-300 mt-1">Redeem your MateCoins for vouchers and badges ğŸ</p>
                </div>
                
                <!-- Coin Balance -->
                <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-6 shadow-2xl relative overflow-hidden group">
                    <div class="absolute inset-0 bg-white/20 transform -skew-x-12 translate-x-full group-hover:translate-x-0 transition-transform duration-700"></div>
                    <div class="text-center relative z-10">
                        <div class="text-xs font-bold text-yellow-900 uppercase tracking-wider mb-1">Your Balance</div>
                        <div class="flex items-center justify-center gap-2">
                            <span class="text-4xl font-black text-white drop-shadow-md">{{ user.coins }}</span>
                            <span class="text-3xl">ğŸª™</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        
        <!-- Messages -->
        {% if messages %}
        <div class="mb-8 space-y-2">
            {% for message in messages %}
            <div class="p-4 rounded-xl text-white font-bold shadow-lg 
                {% if message.tags == 'success' %}bg-green-500
                {% elif message.tags == 'error' %}bg-red-500
                {% else %}bg-blue-500{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Content Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            
            <!-- Vouchers -->
            {% for voucher in vouchers %}
            <div class="group relative bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                <!-- Vendor Banner -->
                <div class="h-24 bg-gradient-to-r 
                    {% if voucher.vendor == 'zomato' %}from-red-500 to-red-600
                    {% elif voucher.vendor == 'swiggy' %}from-orange-500 to-orange-600
                    {% elif voucher.vendor == 'amazon' %}from-gray-700 to-gray-900
                    {% elif voucher.vendor == 'uber' %}from-gray-800 to-black
                    {% else %}from-purple-500 to-indigo-600{% endif %} 
                    flex items-center justify-center">
                    <span class="text-4xl">
                        {% if voucher.vendor == 'zomato' or voucher.vendor == 'swiggy' %}ğŸ•
                        {% elif voucher.vendor == 'uber' or voucher.vendor == 'ola' %}ğŸš—
                        {% elif voucher.vendor == 'amazon' or voucher.vendor == 'flipkart' %}ğŸ›ï¸
                        {% else %}ğŸ{% endif %}
                    </span>
                </div>

                <div class="p-6">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="text-xs font-bold uppercase tracking-wider text-gray-500 dark:text-gray-400">{{ voucher.get_vendor_display }}</span>
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white leading-tight">{{ voucher.title }}</h3>
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2 h-10">{{ voucher.description }}</p>
                    
                    <div class="flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700">
                        <div class="font-bold text-xl text-yellow-600 dark:text-yellow-400 flex items-center gap-1">
                            {{ voucher.cost_in_coins }} ğŸª™
                        </div>
                        
                        <form action="{% url 'rewards:redeem_voucher' voucher.id %}" method="POST" onsubmit="return confirm('Are you sure you want to redeem {{ voucher.title }} for {{ voucher.cost_in_coins }} coins?');">
                            {% csrf_token %}
                            <button type="submit" class="bg-gray-900 hover:bg-black dark:bg-white dark:hover:bg-gray-200 text-white dark:text-gray-900 px-4 py-2 rounded-lg font-bold text-sm transition shadow-lg">
                                Redeem
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}

            <!-- Category Rewards (Badges, etc) -->
            {% for category in categories %}
                {% for reward in category.rewards.all %}
                {% if reward.is_available %}
                <div class="group relative bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-700 hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                     <div class="h-24 bg-gradient-to-r from-indigo-500 to-blue-600 flex items-center justify-center">
                        <span class="text-4xl">
                            {% if reward.reward_type == 'badge' %}ğŸ›¡ï¸
                            {% elif reward.reward_type == 'title' %}ğŸ‘‘
                            {% else %}â­{% endif %}
                        </span>
                    </div>

                    <div class="p-6">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <span class="text-xs font-bold uppercase tracking-wider text-gray-500 dark:text-gray-400">{{ category.name }}</span>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white leading-tight">{{ reward.name }}</h3>
                            </div>
                        </div>
                        
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2 h-10">{{ reward.description }}</p>
                        
                        <div class="flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700">
                            <div class="font-bold text-xl text-yellow-600 dark:text-yellow-400 flex items-center gap-1">
                                {{ reward.cost_in_coins }} ğŸª™
                            </div>
                            
                            <button disabled class="bg-gray-200 text-gray-400 px-4 py-2 rounded-lg font-bold text-sm cursor-not-allowed">
                                Soon
                            </button>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            {% endfor %}

        </div>

        {% if not vouchers and not categories %}
        <div class="text-center py-20">
            <div class="text-6xl mb-4">ğŸª</div>
            <h2 class="text-2xl font-bold text-gray-600 dark:text-gray-400">Marketplace is empty</h2>
            <p class="text-gray-500">Check back later for new rewards!</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}